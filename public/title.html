<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">
    <title>Movie/TV Project</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>
  <body ng-app="app" ng-controller="ctrl">
    <h1 style="text-align:center; padding-top: .5em; padding-bottom:.25em;">Movie/TV Database</h1>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation" style="">
 <span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="navbarColor01">
 <ul class="navbar-nav mr-auto">
   <li class="nav-item active">
     <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
   </li>
   <li class="nav-item">
     <a class="nav-link" href="/about">About</a>
   </li>
 </ul>
 <button type="button" class="btn btn-outline-info" id="edit_btn">Edit</button>
 <button type="button" class="btn btn-outline-info" id="save_btn">Save</button>
  </div>
</nav>
  <div id="movie-info" style="display:inline; position:relative; display:flex; flex-direction:row; flex-wrap:wrap; justify-content:space-around; align-items:center; width=100%;">
  <div>
    <h1 style="margin:0 0 20px 0;">***MOVIE TITLE***</h1>
    <div class="form-group">
    <h4 id="type">Type: ***TITLE TYPE***</h4>
    <h4 id="start">Start Year: ***START*** </h4>
    <h4 id="end">End Year: ***END***</h4>
    <h4 id="run_time">Run Time: ***RUN TIME*** minutes</h4>
    <h4 id="genre">Genre: <div id="genre" style="display:inline"><li class="genre_li" ng-click="remove_li($index)" ng-repeat="genre in cur_genres">{{ genre }}</li></div>
      <div id="genreDrop" style="display:inline; visibility:hidden;">
        <select ng-model="selected_prof" ng-options="genre for genre in other_genre"></select>
        <button type="button" class="btn btn-outline-info" id="addGenre" ng-click="add_genre()">Add</button>
      </div>
    <h4 id="avg_rating">Rating: ***AVERAGE RATE***</h4><h4>Votes: ***NUM VOTES***</h4>
    </div>
  </div>
    <div id="poster"><img src="***POSTER***" border="6" style="width:25em; height:auto; padding-top: 1em;padding-left: 1em;"></div>
  </div>
<br><br><br><br><br><br><br><br><br>
  <div id="top-billed" style="display:block; float:bottom; position:relative;">
    <h4>Top Billed Cast</h4>
    <table class="table table-hover" style="color:#1a1a1a">
  <thead>
    <tr>
      <th scope="col">Type</th>
      <th scope="col">Name</th>
      <th scope="col">Position</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-active" ng-repeat="row in rows">
        <th>{{ $index+1 }}</th>
        <td><a ng-href="{{ row.url }}">{{ row.primary_name }}</a></td>
        <td>{{ row.birth_year }}</td>
        <td>{{ row.death_year }}</td>
        <td>{{ row.end_year }}</td>
    </tr>
  </tbody>
</table>
<br><br>
  </div>
    <script>
    var app = angular.module('app', []);
    app.controller('ctrl', function($scope){
        rows = {rows:***ROWS***};
        for(var i=0;i<rows.rows.length;i++){
            rows.rows[i].url = 'http://cisc-dean.stthomas.edu:8014/title?tconst='+rows.rows[i].tconst;
        }
        $scope.rows = rows.rows;
        //console.log($scope.rows);
        $scope.other_genre = {'producer':'producer','actor':'actor', 'actress':'actress','director':'director','writer':'wrtier','casting':'casting','composer':'composer'};
        $scope.cur_genres = "***GENRE***".split(',');
        //console.log($scope.cur_genres);
        for(var i=0;i<$scope.cur_genres.length;i++){
            delete $scope.other_genre[$scope.cur_genres[i]];
        }
        $scope.remove_li = function(profession){
            if($scope.edit){
                $scope.other_genre[$scope.cur_genres[profession]] = $scope.cur_genres[profession];
              //  console.log($scope.cur_genres);
                //console.log(profession);
                delete $scope.cur_genres[profession];
                var tmp = [];
                for(var i=0;i<$scope.cur_genres.length;i++){
                    if($scope.cur_genres[i]){
                        tmp.push($scope.cur_genres[i]);
                    }
                }
                $scope.cur_genres = tmp;
                //console.log($scope.cur_genres);
                //console.log(tmp);
            }
        }
        $scope.add_prof = function(){
            if($scope.cur_genres.length < 3 && typeof $scope.selected_prof.length !== 'undifined'){
                $scope.cur_genres.push($scope.selected_prof);
                delete $scope.other_genre[$scope.selected_prof.toLowerCase()];
            }
        }
        $scope.begin_edit = function(){
            $scope.edit = true;
        }
        $scope.end_edit = function(){
            $scope.edit = false;
        }

      /*  $scope.post = function() {
          console.log("In the post function");
          var pathname = window.location.href;
          var url = pathname.split("=");
          var nconst = url[1];
          console.log(nconst);
         var birthVal = $("#birthVal").html();
         console.log(birthVal);
          //var deathVal = $("#deathVal").html();
          if(!$.isNumeric(parseInt($("#deathVal").html()))){
            var deathVal = null;
          } else {
            var deathVal = parseInt($("#deathVal").html());
          }//else
          var newProfs = "";
          for(var i=0; i<$scope.cur_genres.length; i++){
              newProfs = newProfs + $scope.cur_genres[i];
          }
          var nameURL = "nameupdate?birth="+ birthVal+"&death="+ deathVal+"&prof="+profAdd + "&nconst"+nconst;
          $http.post(nameURL, data, config).then((successCallback, errorCallback) {
            console.log("Success: " + successCallback);
          });

        }//post*/
    });

        $(document).ready(function(){
            $("#edit_btn").click(function(){
                //$("#type").replaceWith("<input type=\"text\" class=\"form-control\" value=\"***TITLE TYPE***\">");
                $("#genreDrop").css('visibility', 'visible');
              //  <div id="genre" style="display:inline">***GENRE***</div>
              //  $("#genre").replaceWith("<input id=\"tempGenre\" type=\"text\" class=\"form-control\" value=\"***GENRE***\">");
              //  $("#profDrop").css('visibility', 'visible');
                });

                $("#save_btn").click(() => {
                  $("#genreDrop").css('visibility', 'hidden');
                  //$("#genre").replaceWith("<div id=\"genre\" style=\"display:inline\">\"***GENRE***\"</div>");

                });

                $("#addGenre").click(()=>{
                  console.log("Before genres");
                  var genres = $("#tempGenre").val();
                  var currGenres = genres.split(",");
                  console.log(currGenres);
                  var profAdd = $("#genreDrop option:selected").text();
                  console.log(currGenres.length);
                  if(currGenres.length>=3)
                  {
                    alert("Cannot add more genres");
                  }
                  else if(currGenres.length < 3) {
                    console.log("In Else if");
                    currGenres.push(profAdd);
                    console.log(profAdd);
                    console.log(currGenres);
                  }
                  var newGenre = "";
                  for(var i=0 ; i<currGenres.length; i++){
                    newGenre = newGenre+ currGenres[i];
                  }
                  $("#tempGenre").replace("***GENRE***", newGenre);
                //  console.log(genres);

                });


        });


    </script>
  </body>

</html>
